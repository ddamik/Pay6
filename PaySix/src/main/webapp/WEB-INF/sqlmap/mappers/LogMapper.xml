<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="LogMapper">



	<!-- 
		1. insert log
		2. order_list ( status: 1 + status: 2 )
		3. update_status
	-->
	
	
	
	<!-- insert log -->
	<insert id="insert_log" parameterType="LogVO">
		insert
			into
		log(
			tno,
			orderno,
			status,
			pid,
			userid,
			paymethod
		)
		values(
			#{tno},
			#{orderno},
			#{status},
			#{pid},
			#{userid},
			#{paymethod}		
		)		
	</insert>
	
	
	<!-- 2. order_list -->
	<select id="onwer_order_list" parameterType="hashmap" resultType="OwnerOrderVO">
		select
			log.seqid as seqid,
			log.orderno as orderno,
			log.tno as tno,        
	        log.status as status,
	        productinfo.pname as pname
		from
			log,
			productinfo
		where
			log.pid = productinfo.pid
		and 
			date(log.ordertime) = date(now())
		and 
			log.status = #{status}
		and
			productinfo.sid = #{sid}
	</select>
	
	<!-- 2. join table -->
	<resultMap type="OwnerOrderVO" id="owner_order_list_status_1">
		<id property="seqid" column="seqid"/>
		<result property="tno" column="tno"/>
		<result property="orderno" column="orderno"/>
		<result property="status" column="status"/>
		<result property="pname" column="pname"/>
	</resultMap>
	
	
	
	
	
	<!-- 3. update status -->
	<update id="update_status" parameterType="int">
		update
			log
		set
			status = 2
		where
			seqid = #{seqid}
	</update>
	
	
	
	
	
	
	
			
		
		<!-- 
		/*
		 * select 
	pid, 
	count(pid) 
from 
	log 
where
	concat(year(ordertime), '-', month(ordertime), '-', day(ordertime)) = concat(year(current_timestamp()), '-', month(current_timestamp()), '-', day(current_timestamp()))
group by 
	pid;
	
	
	created_date between '2013-10-10' and '2013-10-14';
		 */
	-->
	
	<!-- 현재 시간대 판매량 데이터 ( 오늘 / 어제 )-->	
	<select id="currentTime_salesData" parameterType="hashmap" resultType="LogVO">
		select
			pid,
			ordertime,
			count(pid) as etc1
		from
			log
		where
			concat(year(ordertime), '-', month(ordertime), '-', day(ordertime), ' ', hour(ordertime)) = #{current_time}
		and
			mid(pid, 1, 4) = #{pid}
		group by
			pid				
	</select>
	
	
	<!-- 현재 시간까지 판매량 데이터 ( 오늘 / 어제 ) -->
	<select id="fromMidNight_salesData" parameterType="hashmap" resultType="LogVO">
		select
			pid,
			count(pid) as etc1
		from
			log
		where
			ordertime between #{mid_night} and current_timestamp()
		and
			mid(pid, 1, 4) = #{pid}
		group by
			pid
	</select>
	
	
	
	
	
	
	
	
	
	
	
	
	
	<!-- Random data -->
		<insert id="insert_random_log" parameterType="LogVO">
		insert
			into
		log(
			tno,
			orderno,
			status,
			pid,
			userid,
			paymethod,
			ordertime
		)
		values(
			#{tno},
			#{orderno},
			#{status},
			#{pid},
			#{userid},
			#{paymethod},
			#{ordertime}		
		)		
	</insert>
	

</mapper>